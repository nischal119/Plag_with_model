{% extends "auth/base.html" %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="auth-form-container">
  <div class="auth-form-header">
    <h2><i class="fas fa-user-plus"></i> Create Account</h2>
    <p>Join us to start using the plagiarism detection system.</p>
  </div>

  <form method="POST" class="auth-form">
    {{ form.hidden_tag() }}

    <div class="form-row">
      <div class="form-group">
        {{ form.first_name.label(class="form-label") }}
        {{ form.first_name(class="form-control" + (" error" if form.first_name.errors else "")) }}
        {% for error in form.first_name.errors %}
        <span class="error-message">{{ error }}</span>
        {% endfor %}
      </div>

      <div class="form-group">
        {{ form.last_name.label(class="form-label") }}
        {{ form.last_name(class="form-control" + (" error" if form.last_name.errors else "")) }}
        {% for error in form.last_name.errors %}
        <span class="error-message">{{ error }}</span>
        {% endfor %}
      </div>
    </div>

    <div class="form-group">
      {{ form.username.label(class="form-label") }}
      {{ form.username(class="form-control" + (" error" if form.username.errors else "")) }}
      {% for error in form.username.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
      <small class="form-help">Choose a unique username (3-80 characters)</small>
    </div>

    <div class="form-group">
      {{ form.email.label(class="form-label") }}
      {{ form.email(class="form-control" + (" error" if form.email.errors else "")) }}
      {% for error in form.email.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
    </div>

    <div class="form-group">
      {{ form.password.label(class="form-label") }}
      <div class="password-input-container">
        {{ form.password(class="form-control" + (" error" if form.password.errors else ""), id="password") }}
        <button type="button" class="password-toggle" onclick="togglePassword('password')">
          <i class="fas fa-eye" id="password-eye"></i>
        </button>
      </div>
      {% for error in form.password.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
      <div class="password-strength" id="password-strength"></div>
    </div>

    <div class="form-group">
      {{ form.password2.label(class="form-label") }}
      <div class="password-input-container">
        {{ form.password2(class="form-control" + (" error" if form.password2.errors else ""), id="password2") }}
        <button type="button" class="password-toggle" onclick="togglePassword('password2')">
          <i class="fas fa-eye" id="password2-eye"></i>
        </button>
      </div>
      {% for error in form.password2.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
    </div>

    <div class="form-group">
      {{ form.submit(class="btn btn-primary btn-full") }}
    </div>
  </form>

  <div class="auth-links">
    <p>Already have an account? <a href="{{ url_for('auth.login') }}" class="auth-link">Sign in here</a></p>
  </div>
</div>

<script>
  // Password strength indicator
  document.getElementById('password').addEventListener('input', function () {
    const password = this.value;
    const strengthDiv = document.getElementById('password-strength');

    let strength = 0;
    let feedback = [];

    if (password.length >= 6) strength++;
    else feedback.push('At least 6 characters');

    if (/[a-z]/.test(password)) strength++;
    else feedback.push('Lowercase letter');

    if (/[A-Z]/.test(password)) strength++;
    else feedback.push('Uppercase letter');

    if (/[0-9]/.test(password)) strength++;
    else feedback.push('Number');

    if (/[^a-zA-Z0-9]/.test(password)) strength++;
    else feedback.push('Special character');

    const levels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
    const colors = ['#ff4757', '#ff6b35', '#ffa502', '#2ed573', '#5f27cd'];

    if (password.length === 0) {
      strengthDiv.innerHTML = '';
    } else {
      strengthDiv.innerHTML = `
            <div class="strength-bar">
                <div class="strength-fill" style="width: ${(strength / 5) * 100}%; background-color: ${colors[strength - 1] || colors[0]}"></div>
            </div>
            <span class="strength-text" style="color: ${colors[strength - 1] || colors[0]}">${levels[strength - 1] || levels[0]}</span>
        `;
    }
  });
</script>
{% endblock %}