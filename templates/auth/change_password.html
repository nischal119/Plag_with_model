{% extends "auth/base.html" %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="auth-form-container">
  <div class="auth-form-header">
    <h2><i class="fas fa-lock"></i> Change Password</h2>
    <p>Update your account password for better security.</p>
  </div>

  <form method="POST" class="auth-form">
    {{ form.hidden_tag() }}

    <div class="form-group">
      {{ form.current_password.label(class="form-label") }}
      <div class="password-input-container">
        {{ form.current_password(class="form-control" + (" error" if form.current_password.errors else ""),
        id="current_password") }}
        <button type="button" class="password-toggle" onclick="togglePassword('current_password')">
          <i class="fas fa-eye" id="current_password-eye"></i>
        </button>
      </div>
      {% for error in form.current_password.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
    </div>

    <div class="form-group">
      {{ form.new_password.label(class="form-label") }}
      <div class="password-input-container">
        {{ form.new_password(class="form-control" + (" error" if form.new_password.errors else ""), id="new_password")
        }}
        <button type="button" class="password-toggle" onclick="togglePassword('new_password')">
          <i class="fas fa-eye" id="new_password-eye"></i>
        </button>
      </div>
      {% for error in form.new_password.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
      <div class="password-strength" id="password-strength"></div>
    </div>

    <div class="form-group">
      {{ form.new_password2.label(class="form-label") }}
      <div class="password-input-container">
        {{ form.new_password2(class="form-control" + (" error" if form.new_password2.errors else ""),
        id="new_password2") }}
        <button type="button" class="password-toggle" onclick="togglePassword('new_password2')">
          <i class="fas fa-eye" id="new_password2-eye"></i>
        </button>
      </div>
      {% for error in form.new_password2.errors %}
      <span class="error-message">{{ error }}</span>
      {% endfor %}
    </div>

    <div class="form-group form-actions">
      {{ form.submit(class="btn btn-primary") }}
      <a href="{{ url_for('profile') }}" class="btn btn-secondary">
        <i class="fas fa-times"></i> Cancel
      </a>
    </div>
  </form>

  <div class="auth-links">
    <p><a href="{{ url_for('profile') }}" class="auth-link">Back to Profile</a></p>
  </div>

  <div class="security-tips">
    <h4><i class="fas fa-shield-alt"></i> Password Security Tips</h4>
    <ul>
      <li>Use at least 8 characters</li>
      <li>Include uppercase and lowercase letters</li>
      <li>Add numbers and special characters</li>
      <li>Avoid common words or personal information</li>
      <li>Don't reuse passwords from other accounts</li>
    </ul>
  </div>
</div>

<script>
  // Password strength indicator (same as signup)
  document.getElementById('new_password').addEventListener('input', function () {
    const password = this.value;
    const strengthDiv = document.getElementById('password-strength');

    let strength = 0;
    let feedback = [];

    if (password.length >= 6) strength++;
    else feedback.push('At least 6 characters');

    if (/[a-z]/.test(password)) strength++;
    else feedback.push('Lowercase letter');

    if (/[A-Z]/.test(password)) strength++;
    else feedback.push('Uppercase letter');

    if (/[0-9]/.test(password)) strength++;
    else feedback.push('Number');

    if (/[^a-zA-Z0-9]/.test(password)) strength++;
    else feedback.push('Special character');

    const levels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
    const colors = ['#ff4757', '#ff6b35', '#ffa502', '#2ed573', '#5f27cd'];

    if (password.length === 0) {
      strengthDiv.innerHTML = '';
    } else {
      strengthDiv.innerHTML = `
            <div class="strength-bar">
                <div class="strength-fill" style="width: ${(strength / 5) * 100}%; background-color: ${colors[strength - 1] || colors[0]}"></div>
            </div>
            <span class="strength-text" style="color: ${colors[strength - 1] || colors[0]}">${levels[strength - 1] || levels[0]}</span>
        `;
    }
  });
</script>
{% endblock %}